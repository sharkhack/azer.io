var azr_opt={type:"grayscale",desc:{grayscale:"Download the grayscaled image",general:"Download the image"},opts:null};function addImage(e){var t=azr_opt.desc.general;switch(azr_opt.type){case"grayscale":t=azr_opt.desc.grayscale}var a=document.createElement("div");a.setAttribute("style","margin: 20px 0;"),a.innerHTML='<div class="image" style="width:100%; text-align:center; margin:8px 0;">  <img /></div><div class="downloadbtn" style="width:100%; text-align:right;"><a download="" href="" title="'+t+'" class="btn btn-primary">Download</a></div>',getHeader(e,function(t){var n=a.querySelector("img"),r=a.querySelector(".btn-primary");r.setAttribute("download",e.name);var d=window.URL||window.webkitURL,i=new Image;".jpg"==(t=null!==t?t:"image/jpeg")||"jpg"==t||"jpeg"==t?t="image/jpeg":"png"!=t&&".png"!=t||(t="image/png"),getExifData(e,function(a){var l=null;null!==a&&"undefined"!=typeof piexif&&(l=getValidOrientation(a["0th"][piexif.ImageIFD.Orientation])),i.onload=function(){setTimeout(function(){switch(azr_opt.type){case"grayscale":n.src=gray(i,t,l);break;case"rgbchannels":n.src=rgbchannels(i,t,l)}r.setAttribute("href",n.src);try{try{d.revokeObjectURL(i.src)}catch(e){}try{i.src=""}catch(e){}i=null}catch(e){}},0)},i.src=d.createObjectURL(e)})}),document.getElementById("images").appendChild(a)}function getValidOrientation(e){return Number.isInteger(e)?e<1||e>8?1:e:1}function getExifData(e,t){var a=new FileReader;a.onloadend=function(e){var n=a.result;if(null===n||"undefined"==typeof piexif)t(null);else{var r=null;try{(r=piexif.load(n)).thumbnail=null}catch(e){}t(r)}a=void 0},a.onerror=function(){t(null),a=void 0},a.readAsBinaryString(e)}function getHeader(e,t){if(window.FileReader&&window.Blob&&void 0!==typeof e.type)t(e.type);else{var a=e,n=new FileReader;n.onloadend=function(e){for(var a=new Uint8Array(e.target.result).subarray(0,4),r="",d=0;d<a.length;d++)r+=a[d].toString(16);var i=null;switch(r){case"89504e47":i="image/png";break;case"47494638":i="image/gif";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":i="image/jpeg";break;default:i=null}t(i),n=void 0},n.readAsArrayBuffer(a)}}function translate(e,t,a){var n=e.width,r=e.height;switch(a>4&&(e.width=r,e.height=n),a){case 2:t.translate(n,0),t.scale(-1,1);break;case 3:t.translate(n,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(n,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-n,0)}}function gray(e,t,a){var n=document.createElement("canvas"),r=n.getContext("2d"),d=e.width,i=e.height;n.width=d,n.height=i,null!==a&&a>2&&a<=8&&(translate(n,r,a),d=n.width,i=n.height),r.drawImage(e,0,0);for(var l=r.getImageData(0,0,d,i),o=0;o<l.height;o++)for(var c=0;c<l.width;c++){var g=4*o*l.width+4*c,s=(l.data[g]+l.data[g+1]+l.data[g+2])/3;l.data[g]=s,l.data[g+1]=s,l.data[g+2]=s}return r.putImageData(l,0,0,0,0,l.width,l.height),n.toDataURL(t,.8)}function rgbchannels(e,t,a){var n=document.createElement("canvas"),r=n.getContext("2d"),d=azr_opt.opts;null==d&&(d={r:!0,g:!1,b:!1});var i=e.width,l=e.height;n.width=i,n.height=l,null!==a&&a>2&&a<=8&&(translate(n,r,a),i=n.width,l=n.height),r.drawImage(e,0,0);for(var o=r.getImageData(0,0,i,l),c=d.r?1:0,g=d.g?1:0,s=d.b?1:0,u=i*l*4,f=0;f<u;f+=4)o.data[f]=o.data[f]*c,o.data[f+1]=o.data[f+1]*g,o.data[f+2]=o.data[f+2]*s;return r.putImageData(o,0,0,0,0,o.width,o.height),n.toDataURL(t,.8)}function handleImages(e){document.getElementById("images").innerHTML="";for(var t=0;t<e.length;t++)addImage(e[t])}document.ondragover=function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},document.ondrop=function(e){e.preventDefault(),window.uploaded_files=e.dataTransfer.files,handleImages(e.dataTransfer.files)},function(){var e=document.getElementById("btn_apply_rgb_channels");null!==e&&(azr_opt.type="rgbchannels",e.onclick=function(){if(void 0!==window.uploaded_files&&null!==window.uploaded_files){var e=1==document.getElementById("red").checked,t=1==document.getElementById("green").checked,a=1==document.getElementById("blue").checked;azr_opt.opts={r:e,g:t,b:a},handleImages(window.uploaded_files)}});var t=document.getElementById("upload"),a=document.getElementById("target");t.onchange=function(){if(window.uploaded_files=this.files,null!==e){var t=1==document.getElementById("red").checked,a=1==document.getElementById("green").checked,n=1==document.getElementById("blue").checked;azr_opt.opts={r:t,g:a,b:n}}handleImages(this.files)},a.onclick=function(){t.click()}}();